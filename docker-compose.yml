version: "3.8"

services:
  # ãƒ¡ã‚¤ãƒ³ã®Gauge MCP Server
  gauge-mcp-server:
    build: .
    container_name: gauge-mcp-server
    environment:
      - NODE_ENV=production
    volumes:
      # Gaugeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒã‚¦ãƒ³ãƒˆï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
      - ./projects:/app/projects
      # stdioã§MCPã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦å‹•ä½œã™ã‚‹ãŸã‚ã€TTYã‚’æœ‰åŠ¹ã«ã™ã‚‹
    restart: unless-stopped
    stdin_open: true
    tty: true

  # MCP Inspectorï¼ˆé–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç”¨ï¼‰
  mcp-inspector:
    build: .
    container_name: mcp-inspector
    ports:
      - "6274:6274"
      - "6277:6277"
    environment:
      - NODE_ENV=development
    volumes:
      - ./projects:/app/projects
    command: >
      sh -c "
        npm install -g @modelcontextprotocol/inspector &&
        npx @modelcontextprotocol/inspector node build/index.js
      "
    depends_on:
      - gauge-mcp-server
    profiles:
      - inspector
      - dev

  # ãƒ†ã‚¹ãƒˆç’°å¢ƒï¼ˆã™ã¹ã¦ã®ãƒ„ãƒ¼ãƒ«ã®å‹•ä½œç¢ºèªç”¨ï¼‰
  gauge-test-env:
    build: .
    container_name: gauge-test-env
    environment:
      - NODE_ENV=test
    volumes:
      - ./projects:/app/projects
      - ./examples:/app/examples
    working_dir: /app
    command: >
      sh -c "
        echo 'ğŸ§ª Gauge MCP Server ãƒ†ã‚¹ãƒˆç’°å¢ƒ';
        echo 'ğŸ“‹ åˆ©ç”¨å¯èƒ½ãªãƒ„ãƒ¼ãƒ«:';
        echo '  1. create_from_template - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ';
        echo '  2. get_implemented_steps - å®Ÿè£…æ¸ˆã¿ã‚¹ãƒ†ãƒƒãƒ—å–å¾—';
        echo '  3. run_gauge - Gaugeã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ';
        echo '';
        echo 'ğŸ’¡ ä½¿ç”¨ä¾‹:';
        echo 'docker-compose exec gauge-test-env gauge version';
        echo 'docker-compose exec gauge-test-env ls -la /app/projects';
        echo '';
        echo 'Press Ctrl+C to exit...';
        sleep infinity
      "
    profiles:
      - test
      - dev
